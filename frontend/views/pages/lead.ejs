<%- include('../partials/header', { title: 'Free SIP Consultation', description: 'Talk to a SEBI-registered mutual fund advisor in Pune. Free consultation, no obligation.' }) %>

<style>
  :root {
    --primary: #2d5e4f; --primary-dark: #1f4438; --primary-light: #3d7e6f;
    --success: #10b981; --gray-50: #f9fafb; --gray-100: #f3f4f6;
    --gray-200: #e5e7eb; --gray-300: #d1d5db; --gray-500: #6b7280;
    --gray-700: #374151; --gray-900: #111827; --text-tertiary: #9ca3af;
    --radius-lg: 0.75rem; --radius-2xl: 1.5rem;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Inter', sans-serif; background: #f5f7f6; color: var(--gray-900); line-height: 1.6; margin-top: 4.5rem; }

  /* Hero */
  .lead-hero {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    padding: 4rem 0; color: white; position: relative; overflow: hidden;
  }
  .lead-hero::before {
    content: ''; position: absolute; top: -50%; right: -20%;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%;
  }
  .lead-hero h1 { font-size: 2.5rem; font-weight: 700; color: white; margin-bottom: 1rem; position: relative; z-index: 2; }
  .lead-hero p  { font-size: 1.125rem; opacity: 0.95; position: relative; z-index: 2; }

  /* Form */
  .form-wrapper { position: relative; padding-bottom: 3rem; }
  .form-container { max-width: 750px; margin: -2.5rem auto 3rem; position: relative; z-index: 10; }
  .form-card {
    background: white; border-radius: var(--radius-2xl); padding: 3rem;
    box-shadow: 0 20px 60px rgba(0,0,0,0.12); border: 1px solid var(--gray-200);
    animation: slideUp 0.5s ease-out;
  }
  @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

  /* Progress */
  .progress-section { margin-bottom: 2.5rem; }
  .progress-label { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; font-size: 0.875rem; font-weight: 500; color: var(--gray-700); }
  .progress-bar-container { width: 100%; height: 4px; background: var(--gray-200); border-radius: 2px; overflow: hidden; }
  .progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary-light)); border-radius: 2px; transition: width 0.4s ease; width: 25%; }

  /* Steps */
  .step-indicators { display: flex; justify-content: space-between; gap: 1rem; margin-bottom: 2.5rem; position: relative; }
  .step-indicators::before { content: ''; position: absolute; top: 1.25rem; left: 0; right: 0; height: 2px; background: var(--gray-200); z-index: 1; }
  .step-indicator {
    width: 2.5rem; height: 2.5rem; border-radius: 50%; background: white;
    border: 2px solid var(--gray-300); display: flex; align-items: center; justify-content: center;
    font-weight: 600; font-size: 0.875rem; color: var(--text-tertiary);
    position: relative; z-index: 3; transition: all 0.3s ease; flex-shrink: 0;
  }
  .step-indicator.active    { border-color: var(--primary); background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(45,94,79,0.25); }
  .step-indicator.completed { border-color: var(--success); background: var(--success); color: white; }

  /* Form sections */
  .form-section { display: none; animation: fadeIn 0.3s ease; }
  .form-section.active { display: block; }
  @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
  .section-title { font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem; }
  .section-subtitle { font-size: 0.95rem; color: var(--gray-500); margin-bottom: 2rem; }

  /* Fields */
  .form-group { margin-bottom: 1.75rem; }
  .form-label { display: block; font-size: 0.95rem; font-weight: 500; color: var(--gray-900); margin-bottom: 0.5rem; }
  .required { color: #ef4444; }
  .form-control { width: 100%; padding: 0.875rem 1rem; border: 1.5px solid var(--gray-200); border-radius: var(--radius-lg); font-size: 0.95rem; font-family: inherit; transition: all 0.2s ease; background: white; }
  .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(45,94,79,0.1); }
  .form-control::placeholder { color: var(--text-tertiary); }

  /* Options */
  .option-group { display: grid; gap: 1rem; }
  .option-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 1rem; border: 1.5px solid var(--gray-200); border-radius: var(--radius-lg); cursor: pointer; transition: all 0.2s ease; }
  .option-item:hover { border-color: var(--primary); background: rgba(45,94,79,0.02); }
  .option-item input[type="radio"], .option-item input[type="checkbox"] { margin-top: 0.25rem; cursor: pointer; accent-color: var(--primary); width: 1.25rem; height: 1.25rem; }
  .option-item.selected { border-color: var(--primary); background: rgba(45,94,79,0.05); }
  .option-label { cursor: pointer; flex: 1; }
  .option-label .label { display: block; font-weight: 500; color: var(--gray-900); margin-bottom: 0.25rem; }
  .option-label .description { font-size: 0.85rem; color: var(--gray-500); }

  /* Range */
  .range-input-group { margin-bottom: 1.75rem; }
  input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: var(--gray-200); outline: none; -webkit-appearance: none; }
  input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 1.5rem; height: 1.5rem; border-radius: 50%; background: var(--primary); cursor: pointer; box-shadow: 0 2px 8px rgba(45,94,79,0.3); transition: all 0.2s ease; }
  input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.1); }
  input[type="range"]::-moz-range-thumb { width: 1.5rem; height: 1.5rem; border-radius: 50%; background: var(--primary); cursor: pointer; border: none; box-shadow: 0 2px 8px rgba(45,94,79,0.3); }
  .range-display { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; padding: 1rem; background: var(--gray-50); border-radius: var(--radius-lg); }
  .range-display-value { font-size: 1.75rem; font-weight: 700; color: var(--primary); }
  .range-display-label { font-size: 0.875rem; color: var(--gray-500); }

  /* Benefits */
  .benefits-list { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem; padding: 1.5rem; background: rgba(16,185,129,0.05); border-radius: var(--radius-lg); border-left: 4px solid var(--success); }
  .benefit-item { display: flex; gap: 0.75rem; align-items: flex-start; }
  .benefit-icon { color: var(--success); font-size: 1.25rem; margin-top: 0.1rem; flex-shrink: 0; }
  .benefit-text { font-size: 0.95rem; color: var(--gray-700); }
  .benefit-text strong { font-weight: 600; color: var(--gray-900); }

  /* Error */
  .error-message { display: none; padding: 1rem; margin-bottom: 1.5rem; background: #fee2e2; border: 1.5px solid #fca5a5; border-radius: var(--radius-lg); color: #7f1d1d; font-size: 0.95rem; animation: slideDown 0.3s ease; }
  .error-message.active { display: block; }
  @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }

  /* Nav buttons */
  .form-navigation { display: flex; gap: 1rem; margin-top: 2.5rem; }
  .btn { padding: 0.875rem 1.75rem; border: none; border-radius: var(--radius-lg); font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.5rem; }
  .btn-back { background: var(--gray-100); color: var(--gray-700); }
  .btn-back:hover { background: var(--gray-200); }
  .btn-next { background: var(--primary); color: white; margin-left: auto; }
  .btn-next:hover { background: var(--primary-dark); transform: translateY(-1px); }
  .btn-submit { background: var(--success); color: white; margin-left: auto; }
  .btn-submit:hover { background: #059669; transform: translateY(-1px); }
  .btn-submit:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

  /* Success */
  .success-message { display: none; text-align: center; padding: 2.5rem 2rem; }
  .success-message.active { display: block; }
  .success-icon { width: 5rem; height: 5rem; background: linear-gradient(135deg, var(--success), #34d399); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; margin: 0 auto 1.5rem; }
  .success-title { font-size: 1.75rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.75rem; }
  .success-text  { font-size: 1rem; color: var(--gray-500); margin-bottom: 2rem; }
  .success-details { display: grid; gap: 1rem; background: var(--gray-50); padding: 1.5rem; border-radius: var(--radius-lg); text-align: left; }
  .success-detail-item { display: flex; justify-content: space-between; align-items: center; }
  .success-detail-label { font-size: 0.875rem; color: var(--gray-500); }
  .success-detail-value { font-weight: 600; color: var(--gray-900); }
</style>

<!-- HERO -->
<section class="lead-hero">
  <div class="container">
    <h1>Request a Free SIP Consultation</h1>
    <p>Talk to our AMFI-registered mutual fund distributor. No obligation, completely free.</p>
  </div>
</section>

<!-- FORM -->
<div class="form-wrapper">
  <div class="form-container container">
    <div class="form-card">

      <!-- Progress -->
      <div class="progress-section">
        <div class="progress-label">
          <span>Step <span id="currentStep">1</span> of 4</span>
          <span id="progressPercent">25%</span>
        </div>
        <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
      </div>

      <!-- Step indicators -->
      <div class="step-indicators">
        <div class="step-indicator active" id="step1Indicator">1</div>
        <div class="step-indicator" id="step2Indicator">2</div>
        <div class="step-indicator" id="step3Indicator">3</div>
        <div class="step-indicator" id="step4Indicator">4</div>
      </div>

      <form id="leadForm">
        <div id="errorMessage" class="error-message"><span id="errorText"></span></div>

        <!-- Step 1: Personal Info -->
        <div class="form-section active" id="step1">
          <h2 class="section-title">Let's start with the basics</h2>
          <p class="section-subtitle">Tell us a bit about yourself</p>
          <div class="form-group"><label class="form-label">Full Name <span class="required">*</span></label><input type="text" id="name" class="form-control" placeholder="Your full name" required></div>
          <div class="form-group"><label class="form-label">Phone Number <span class="required">*</span></label><input type="tel" id="phone" class="form-control" placeholder="10-digit mobile number" required></div>
          <div class="form-group"><label class="form-label">Email Address <span class="required">*</span></label><input type="email" id="email" class="form-control" placeholder="you@example.com" required></div>
          <div class="form-group">
            <label class="form-label">Age Group <span class="required">*</span></label>
            <div class="option-group">
              <label class="option-item"><input type="radio" name="ageGroup" value="25-35"><span class="option-label"><span class="label">25 – 35 years</span><span class="description">Early career, building wealth</span></span></label>
              <label class="option-item"><input type="radio" name="ageGroup" value="35-45"><span class="option-label"><span class="label">35 – 45 years</span><span class="description">Mid-career, growing wealth</span></span></label>
              <label class="option-item"><input type="radio" name="ageGroup" value="45-55"><span class="option-label"><span class="label">45 – 55 years</span><span class="description">Pre-retirement planning</span></span></label>
              <label class="option-item"><input type="radio" name="ageGroup" value="55+"><span class="option-label"><span class="label">55+ years</span><span class="description">Retirement &amp; income planning</span></span></label>
            </div>
          </div>
        </div>

        <!-- Step 2: Investment Info -->
        <div class="form-section" id="step2">
          <h2 class="section-title">Your investment picture</h2>
          <p class="section-subtitle">Help us understand where you are financially</p>
          <div class="form-group">
            <label class="form-label">Do you have existing SIPs? <span class="required">*</span></label>
            <div class="option-group">
              <label class="option-item"><input type="radio" name="hasSIP" value="yes"><span class="option-label"><span class="label">Yes, I have SIPs running</span></span></label>
              <label class="option-item"><input type="radio" name="hasSIP" value="no"><span class="option-label"><span class="label">No, I'm new to SIP investing</span></span></label>
            </div>
          </div>
          <div id="existingSIPAmount" style="display:none;" class="form-group">
            <label class="form-label">Current monthly SIP amount</label>
            <div class="option-group">
              <label class="option-item"><input type="radio" name="sipAmount" value="below-5k"><span class="option-label"><span class="label">Below ₹5,000</span></span></label>
              <label class="option-item"><input type="radio" name="sipAmount" value="5k-10k"><span class="option-label"><span class="label">₹5,000 – ₹10,000</span></span></label>
              <label class="option-item"><input type="radio" name="sipAmount" value="10k-25k"><span class="option-label"><span class="label">₹10,000 – ₹25,000</span></span></label>
              <label class="option-item"><input type="radio" name="sipAmount" value="25k-50k"><span class="option-label"><span class="label">₹25,000 – ₹50,000</span></span></label>
              <label class="option-item"><input type="radio" name="sipAmount" value="50k+"><span class="option-label"><span class="label">₹50,000+</span></span></label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Desired monthly investment <span class="required">*</span></label>
            <div class="range-input-group">
              <input type="range" id="investAmount" min="5000" max="500000" step="5000" value="25000" required>
              <div class="range-display">
                <span class="range-display-label">Monthly Amount</span>
                <span class="range-display-value">₹<span id="investAmountDisplay">25,000</span></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Objective -->
        <div class="form-section" id="step3">
          <h2 class="section-title">What can we help you with?</h2>
          <p class="section-subtitle">Select your primary goal</p>
          <div class="form-group">
            <label class="form-label">Primary Objective <span class="required">*</span></label>
            <div class="option-group">
              <label class="option-item"><input type="radio" name="objective" value="start_sip"><span class="option-label"><span class="label">Start a New SIP</span><span class="description">Begin my investment journey</span></span></label>
              <label class="option-item"><input type="radio" name="objective" value="step_up"><span class="option-label"><span class="label">Step Up My SIP</span><span class="description">Increase my monthly contribution</span></span></label>
              <label class="option-item"><input type="radio" name="objective" value="portfolio_review"><span class="option-label"><span class="label">Portfolio Review</span><span class="description">Review existing investments</span></span></label>
              <label class="option-item"><input type="radio" name="objective" value="goal_planning"><span class="option-label"><span class="label">Goal Planning &amp; Strategy</span><span class="description">Plan for specific life goals</span></span></label>
              <label class="option-item"><input type="radio" name="objective" value="risk_assessment"><span class="option-label"><span class="label">Risk Assessment &amp; Advice</span><span class="description">Understand my risk profile</span></span></label>
            </div>
          </div>
        </div>

        <!-- Step 4: Goals -->
        <div class="form-section" id="step4">
          <h2 class="section-title">Your Financial Goals</h2>
          <p class="section-subtitle">What are you saving for?</p>
          <div class="form-group">
            <label class="form-label">Primary Financial Goal <span class="required">*</span></label>
            <div class="option-group">
              <label class="option-item"><input type="radio" name="goal" value="retirement"><span class="option-label"><span class="label">Retirement Planning</span><span class="description">Secure financial future after retirement</span></span></label>
              <label class="option-item"><input type="radio" name="goal" value="child_education"><span class="option-label"><span class="label">Child's Education</span><span class="description">Fund quality education</span></span></label>
              <label class="option-item"><input type="radio" name="goal" value="home"><span class="option-label"><span class="label">Home Purchase</span><span class="description">Down payment for a house</span></span></label>
              <label class="option-item"><input type="radio" name="goal" value="wealth_creation"><span class="option-label"><span class="label">Wealth Creation</span><span class="description">Build long-term wealth</span></span></label>
              <label class="option-item"><input type="radio" name="goal" value="vacation"><span class="option-label"><span class="label">Dream Vacation</span><span class="description">Fund travel and experiences</span></span></label>
              <label class="option-item"><input type="radio" name="goal" value="other"><span class="option-label"><span class="label">Other Goal</span></span></label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">When do you need this? <span class="required">*</span></label>
            <div class="option-group">
              <label class="option-item"><input type="radio" name="goalTimeline" value="1-3years"><span class="option-label"><span class="label">1 – 3 years</span><span class="description">Short-term goal</span></span></label>
              <label class="option-item"><input type="radio" name="goalTimeline" value="3-5years"><span class="option-label"><span class="label">3 – 5 years</span><span class="description">Medium-term goal</span></span></label>
              <label class="option-item"><input type="radio" name="goalTimeline" value="5-10years"><span class="option-label"><span class="label">5 – 10 years</span><span class="description">Long-term goal</span></span></label>
              <label class="option-item"><input type="radio" name="goalTimeline" value="10+years"><span class="option-label"><span class="label">10+ years</span><span class="description">Very long-term goal</span></span></label>
            </div>
          </div>
          <div class="benefits-list">
            <div class="benefit-item"><div class="benefit-icon">✓</div><div class="benefit-text"><strong>100% Free</strong> — No hidden charges or obligations</div></div>
            <div class="benefit-item"><div class="benefit-icon">✓</div><div class="benefit-text"><strong>SEBI Registered</strong> — ARN-123456 | NISM Certified</div></div>
            <div class="benefit-item"><div class="benefit-icon">✓</div><div class="benefit-text"><strong>24-Hour Response</strong> — We'll call you within 24 hours</div></div>
          </div>
          <div class="form-group" style="margin-bottom:0;">
            <label style="display:flex;align-items:flex-start;gap:0.75rem;cursor:pointer;">
              <input type="checkbox" id="agreeTerms" style="margin-top:0.25rem;cursor:pointer;" required>
              <span style="font-size:0.9rem;color:var(--gray-700);">I agree to be contacted and have read the <a href="/terms" style="color:var(--primary);text-decoration:none;">privacy policy</a></span>
            </label>
          </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
          <div class="success-icon"><i class="fas fa-check"></i></div>
          <h2 class="success-title">Consultation Request Submitted!</h2>
          <p class="success-text">Our AMFI-registered Mutual Fund Distributor will contact you shortly.</p>
          <div class="success-details">
            <div class="success-detail-item"><span class="success-detail-label">Expected Call Time</span><span class="success-detail-value">Within 24 hours</span></div>
            <div class="success-detail-item"><span class="success-detail-label">Contact Number</span><span class="success-detail-value" id="successPhone">—</span></div>
            <div class="success-detail-item"><span class="success-detail-label">Your Goal</span><span class="success-detail-value" id="successGoal">—</span></div>
          </div>
          <p style="font-size:0.95rem;color:var(--gray-500);margin-top:1.5rem;">In the meantime, check out our <a href="/newsletter" style="color:var(--primary);text-decoration:none;font-weight:600;">newsletter</a> for helpful tips.</p>
        </div>

        <!-- Navigation -->
        <div id="formNavigation" class="form-navigation">
          <button type="button" class="btn btn-back" id="backBtn" onclick="previousStep()" style="display:none;"><i class="fas fa-arrow-left"></i> Back</button>
          <button type="button" class="btn btn-next" id="nextBtn" onclick="nextStep()">Next <i class="fas fa-arrow-right"></i></button>
          <button type="submit" class="btn btn-submit" id="submitBtn" style="display:none;"><i class="fas fa-paper-plane"></i> Request Consultation</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  let currentStep = 1;
  const totalSteps = 4;

  document.addEventListener('DOMContentLoaded', function() {
    setupRadioListeners();
    setupRangeListener();
    updateUI();
  });

  function setupRadioListeners() {
    document.querySelectorAll('input[name="hasSIP"]').forEach(radio => {
      radio.addEventListener('change', function() {
        document.getElementById('existingSIPAmount').style.display = this.value === 'yes' ? 'block' : 'none';
        document.querySelectorAll('input[name="sipAmount"]').forEach(r => r.required = this.value === 'yes');
      });
    });
    document.querySelectorAll('.option-item input[type="radio"], .option-item input[type="checkbox"]').forEach(input => {
      input.addEventListener('change', function() {
        document.querySelectorAll(`.option-item input[name="${this.name}"]`).forEach(r => r.closest('.option-item').classList.remove('selected'));
        this.closest('.option-item').classList.add('selected');
      });
    });
  }

  function setupRangeListener() {
    const rangeInput = document.getElementById('investAmount');
    rangeInput.addEventListener('input', function() {
      document.getElementById('investAmountDisplay').textContent = parseInt(this.value).toLocaleString('en-IN');
    });
  }

  function validateStep(step) {
    if (step === 1) {
      const name     = document.getElementById('name').value.trim();
      const phone    = document.getElementById('phone').value.trim();
      const email    = document.getElementById('email').value.trim();
      const ageGroup = document.querySelector('input[name="ageGroup"]:checked');
      if (!name)                               { showError('Please enter your full name'); return false; }
      if (!phone || !/^[0-9]{10}$/.test(phone)) { showError('Please enter a valid 10-digit phone number'); return false; }
      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showError('Please enter a valid email'); return false; }
      if (!ageGroup)                           { showError('Please select your age group'); return false; }
    }
    if (step === 2) {
      const hasSIP = document.querySelector('input[name="hasSIP"]:checked');
      if (!hasSIP) { showError('Please select whether you have existing SIPs'); return false; }
      if (hasSIP.value === 'yes' && !document.querySelector('input[name="sipAmount"]:checked')) { showError('Please select your current SIP amount'); return false; }
    }
    if (step === 3) { if (!document.querySelector('input[name="objective"]:checked')) { showError('Please select your primary objective'); return false; } }
    if (step === 4) {
      if (!document.querySelector('input[name="goal"]:checked'))         { showError('Please select your financial goal'); return false; }
      if (!document.querySelector('input[name="goalTimeline"]:checked')) { showError('Please select your goal timeline'); return false; }
      if (!document.getElementById('agreeTerms').checked)                { showError('Please agree to the terms'); return false; }
    }
    hideError(); return true;
  }

  function nextStep()     { if (!validateStep(currentStep)) return; if (currentStep < totalSteps) { currentStep++; updateUI(); scrollToTop(); } }
  function previousStep() { if (currentStep > 1) { currentStep--; updateUI(); scrollToTop(); } }

  function updateUI() {
    document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
    document.getElementById(`step${currentStep}`).classList.add('active');
    for (let i = 1; i <= totalSteps; i++) {
      const ind = document.getElementById(`step${i}Indicator`);
      ind.classList.remove('active','completed');
      if (i < currentStep) ind.classList.add('completed');
      else if (i === currentStep) ind.classList.add('active');
    }
    const progress = (currentStep / totalSteps) * 100;
    document.getElementById('progressBar').style.width      = progress + '%';
    document.getElementById('progressPercent').textContent  = Math.round(progress) + '%';
    document.getElementById('currentStep').textContent      = currentStep;
    document.getElementById('backBtn').style.display        = currentStep > 1 ? 'flex' : 'none';
    document.getElementById('nextBtn').style.display        = currentStep < totalSteps ? 'flex' : 'none';
    document.getElementById('submitBtn').style.display      = currentStep === totalSteps ? 'flex' : 'none';
  }

  function showError(message) {
    const el = document.getElementById('errorMessage');
    document.getElementById('errorText').textContent = message;
    el.classList.add('active');
    el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
  function hideError() { document.getElementById('errorMessage').classList.remove('active'); }
  function scrollToTop() { document.querySelector('.form-card').scrollIntoView({ behavior: 'smooth', block: 'start' }); }

  document.getElementById('leadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const payload = {
      name: document.getElementById('name').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      email: document.getElementById('email').value.trim(),
      age_group: document.querySelector('input[name="ageGroup"]:checked').value,
      has_existing_sip: document.querySelector('input[name="hasSIP"]:checked').value,
      current_sip_amount: document.querySelector('input[name="sipAmount"]:checked')?.value || null,
      desired_investment_amount: document.getElementById('investAmount').value,
      objective: document.querySelector('input[name="objective"]:checked').value,
      financial_goal: document.querySelector('input[name="goal"]:checked').value,
      goal_timeline: document.querySelector('input[name="goalTimeline"]:checked').value,
      city: "Pune"
    };
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
    try {
      const response = await fetch('/api/leads', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (response.ok) {
        document.getElementById('formNavigation').style.display = 'none';
        document.querySelectorAll('.form-section').forEach(s => s.style.display = 'none');
        document.getElementById('successPhone').textContent = payload.phone;
        document.getElementById('successGoal').textContent = payload.financial_goal.replace(/_/g,' ');
        document.getElementById('successMessage').classList.add('active');
      } else {
        throw new Error('Submission failed');
      }
    } catch (error) {
      showError('Unable to submit. Please try again or contact us directly.');
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Request Consultation';
    }
  });
</script>

<%- include('../partials/footer') %>
